Baraneetharan Ramasamy

## **Introduction**

In today's rapidly evolving technological landscape, Artificial Intelligence (AI) has emerged as a game-changer, revolutionizing various industries and transforming the way we live and work. With its ability to process vast amounts of data, learn from patterns, and make intelligent decisions, AI has become an indispensable tool for developers and businesses alike. In this blog, we will explore how .NET, a powerful and versatile framework, meets AI, and uncover the exciting possibilities that arise from this fusion.

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/1904783f-7423-4b4f-aa5f-532420281452/4cb1469b-0d5e-49d2-a445-9b2c9f3f7f1b/image.png)

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/1904783f-7423-4b4f-aa5f-532420281452/ac478545-2ae0-40c6-b602-f3b5bab03c5f/image.png)

## **AI vs ML vs DL vs GenAI**

Before diving into the world of .NET and AI, let's clarify some key terms:

- **AI:** Artificial Intelligence refers to the simulation of human intelligence in machines, enabling them to perform tasks that typically require human intelligence. AI encompasses a wide range of techniques and technologies.
- **ML:** Machine Learning is a subset of AI that focuses on developing algorithms and models that can learn from data and make predictions or decisions without being explicitly programmed. ML algorithms use historical data to identify patterns and make informed choices.
- **DL:** Deep Learning is a subfield of Machine Learning that utilizes artificial neural networks with multiple layers to learn and make complex decisions. Deep Learning models, inspired by the human brain, excel at tasks like image recognition, natural language processing, and speech recognition.
- **GenAI:** Generative AI, or Generative Artificial Intelligence, refers to AI systems that can generate new content, such as text, images, or music, based on learned patterns from existing data. GenAI models can create innovative and creative outputs.

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/1904783f-7423-4b4f-aa5f-532420281452/8ecec5d1-8eff-434d-9271-35ba861cdf86/image.png)

## **Types of Language Models**

Language models are a crucial component of Natural Language Processing (NLP) and play a significant role in AI applications. Here are some common types of language models:

- **Unigram Language Models:** These models consider each word independently and assign probabilities based on word frequency. They are simple but lack contextual understanding.
- **N-gram Language Models:** N-gram models consider sequences of N words, capturing some contextual information. They are useful for tasks like language modeling and speech recognition.
- **Recurrent Neural Network (RNN) Language Models:** RNN-based models utilize neural networks to process sequential data and capture long-term dependencies. They are effective for tasks like language generation and machine translation.
- **Transformer-based Language Models:** Transformer models, such as BERT and GPT, have revolutionized NLP. They use self-attention mechanisms to process input sequences and generate contextualized word embeddings, achieving state-of-the-art performance in various NLP tasks.

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/1904783f-7423-4b4f-aa5f-532420281452/85e2aeb3-77e1-4eab-b04b-7b9b2a4dda7d/image.png)

## **LLM vs SLM Model**

When it comes to language models, we often encounter the terms Large Language Models (LLMs) and Small Language Models (SLMs). Here's a brief comparison:

- **LLMs:** Large Language Models are massive models trained on extensive amounts of text data. They have a vast parameter space and can capture complex linguistic patterns. LLMs are powerful but may require significant computational resources.
- **SLMs:** Small Language Models, on the other hand, are more compact and efficient. They are trained on smaller datasets and are suitable for specific tasks or domains. SLMs are easier to deploy and require less computational power.

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/1904783f-7423-4b4f-aa5f-532420281452/e39bdb2b-7d4f-40fc-9b46-2852b46c019d/image.png)

## **Integrating Large Language Models (LLMs)**

Integrating LLMs into your applications and workflows opens up a world of possibilities. Here are some common ways to incorporate LLMs:

- **API Calling:** Directly interact with the LLM's API by making HTTP requests. This approach provides fine-grained control but requires manual handling of data.
- **Fluent API Calling:** Use libraries or frameworks that provide a more intuitive and readable interface for interacting with LLMs. These APIs simplify the integration process.
- **Cloud Provider Studios:** Leverage managed services and studios offered by cloud providers, such as Azure OpenAI Service Studio or AWS Bedrock Studio. These studios offer graphical interfaces and pre-built components for easy integration.
- **LLM Integration Tools:** Utilize tools like Semantic Kernel or LangChain, which provide higher-level abstractions and frameworks for seamless LLM integration. These tools abstract away low-level details and offer prompt engineering and context management features.

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/1904783f-7423-4b4f-aa5f-532420281452/c8b46088-c150-49bf-b2fe-6829f7da366f/image.png)

## **C#, Java, and JavaScript: Meeting AI**

C#, Java, and JavaScript are versatile programming languages that can be used to develop AI-powered applications:

- **C#:** C# is a powerful language developed by Microsoft, widely used for building Windows applications and web services. It has a rich ecosystem of AI libraries, including ML.NET and Accord.NET, making it an excellent choice for AI development.
- **Java:** Java is a popular language known for its portability and scalability. It offers a wide range of AI libraries, such as Deeplearning4j and Apache MXNet, enabling developers to build robust AI applications.
- **JavaScript:** JavaScript, a language for web development, has gained traction in the AI domain with libraries like TensorFlow.js and ml5.js. It allows developers to create AI-powered web applications and interactive visualizations.

## **ML.NET vs Semantic Kernel**

When it comes to AI development in the .NET ecosystem, two prominent frameworks stand out: ML.NET and Semantic Kernel. Here's a one-liner comparison:

- **ML.NET:** A machine learning framework for .NET developers, offering tools to build and deploy custom models, ideal for tasks like image classification and predictive analytics.
- **Semantic Kernel:** An AI assistant framework that integrates language models and cognitive services, perfect for building conversational AI applications and language-based interfaces.

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/1904783f-7423-4b4f-aa5f-532420281452/b0a03ee9-b682-4a6f-8f60-c1a2bd53edd5/image.png)

## **Features of Semantic Kernel**

Semantic Kernel, developed by Microsoft, offers a range of powerful features:

- **Prompting:** Semantic Kernel provides a flexible prompting system, allowing developers to create and manage prompts for LLMs. Prompts can be customized and optimized for specific tasks.
- **Memory:** The Memory feature enables context management, allowing LLMs to access and utilize relevant information from previous interactions or external sources.
- **Skill Integration:** Semantic Kernel allows developers to integrate various skills, such as reading PDFs, web search, or database operations, into the LLM's workflow.
- **Conversational AI:** Semantic Kernel excels at building conversational AI applications, enabling natural language interactions and context-aware conversations.

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/1904783f-7423-4b4f-aa5f-532420281452/f6e62456-6ba2-4773-8469-8b33aebbd443/image.png)

## **Setting Up Your Development Environment**

To get started with AI development in .NET, follow these steps:

1. **Choose a Language:** Select a programming language that suits your project's requirements, such as C#, Java, or JavaScript.
2. **Install .NET:** Ensure you have the latest version of .NET installed on your machine.
3. **Choose an IDE:** Select an Integrated Development Environment (IDE) like Visual Studio, IntelliJ IDEA, or Visual Studio Code, depending on your language choice.
4. **Install AI Libraries:** Depending on your language, install the necessary AI libraries, such as ML.NET, Accord.NET, or TensorFlow.js.

## **Getting Started**

Once your development environment is set up, you can begin your AI journey:

1. **Explore Tutorials:** Familiarize yourself with AI concepts and techniques by following tutorials and documentation provided by the chosen AI libraries.
2. **Build a Simple Project:** Start with a basic AI project, such as a sentiment analysis classifier or a chatbot, to understand the fundamentals.
3. **Experiment with Data:** Work with different datasets and explore the capabilities of your chosen AI framework.

## **Prompt**

Prompting is a crucial aspect of working with LLMs. Here's how you can utilize prompts effectively:

1. **Define the Task:** Clearly define the task you want the LLM to perform, such as text generation, question answering, or summarization.
2. **Craft the Prompt:** Create a well-designed prompt that provides the necessary context and instructions for the LLM.
3. **Optimize for Performance:** Experiment with different prompt structures and techniques to improve the LLM's performance and generate high-quality outputs.

## **Memory**

Semantic Kernel's Memory feature allows you to manage context and provide relevant information to the LLM:

1. **Store and Retrieve:** Utilize the Memory feature to store and retrieve information from previous interactions or external sources.
2. **Contextual Conversations:** Leverage Memory to create context-aware conversations, where the LLM can access and utilize relevant information to provide more accurate responses.

## **PDF RAG**

Semantic Kernel provides a skill for reading and extracting information from PDF documents:

1. **PDF Skill:** Integrate the PDF skill into your Semantic Kernel application to enable the LLM to read and understand PDF content.
2. **Extract Information:** Use the PDF skill to extract relevant information, such as key points, summaries, or specific sections, from PDF documents.

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/1904783f-7423-4b4f-aa5f-532420281452/6afc6913-6efc-4dcb-89c2-097057a38bf5/image.png)

## **Web**

Semantic Kernel also offers a web skill, allowing you to interact with web services and APIs:

1. **Web Skill:** Integrate the web skill to enable the LLM to access and utilize information from web sources.
2. **Web Search:** Utilize the web skill for web search tasks, enabling the LLM to find relevant information on the internet.

## **CRUD with NLP**

Semantic Kernel can be used for CRUD (Create, Read, Update, Delete) operations with Natural Language Processing (NLP):

1. **Create:** Use Semantic Kernel to create new records or documents by providing natural language instructions to the LLM.
2. **Read:** Retrieve information from a database or document store by asking the LLM to read and extract relevant data.
3. **Update:** Instruct the LLM to update existing records or documents based on natural language commands.
4. **Delete:** Utilize Semantic Kernel to delete records or documents by providing deletion instructions to the LLM.

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/1904783f-7423-4b4f-aa5f-532420281452/106d1c7f-acdb-437d-8d60-a40ca3efdbf8/image.png)

## **Microsoft.Extensions.AI**

Microsoft.Extensions.AI is a set of core .NET libraries developed in collaboration with developers across the .NET ecosystem, including Semantic Kernel. These libraries provide a unified layer of C# abstractions for interacting with AI services, such as small and large language models (SLMs and LLMs), embeddings, and middleware.

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/1904783f-7423-4b4f-aa5f-532420281452/c477d962-21f8-4244-a6ce-63b8da8a0569/image.png)

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/1904783f-7423-4b4f-aa5f-532420281452/c31caa43-0600-405a-9097-198aa473aaeb/image.png)

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/1904783f-7423-4b4f-aa5f-532420281452/96e45491-d0b8-4545-8b41-6b0cdb171c77/image.png)

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/1904783f-7423-4b4f-aa5f-532420281452/5e64e51e-72fa-4c5a-97a7-93c8969dce7f/image.png)

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/1904783f-7423-4b4f-aa5f-532420281452/40d1d80c-1f0f-4d9c-b927-5c9305e7ca30/image.png)

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/1904783f-7423-4b4f-aa5f-532420281452/4e63afa0-5eab-4a59-bac1-c46036e3afa2/image.png)

## **Conclusion**

.NET, with its robust ecosystem and powerful frameworks like ML.NET and Semantic Kernel, meets AI to unlock a world of possibilities. From machine learning to conversational AI, .NET developers can leverage AI technologies to build innovative solutions. By integrating LLMs, developers can create intelligent applications, automate tasks, and enhance user experiences. With the right tools and a solid development environment, the fusion of .NET and AI opens up endless opportunities for innovation and problem-solving.

```jsx
ai vs ml vs dl vs ds

https://studyopedia.com/wp-content/uploads/2022/12/Data-Science-VS-Machine-Learning-VS-Artificial-Intelligence-vs-Deep-Learning-Studyopedia.png

https://studyopedia.com/data-science/difference-datascience-machinelearing-ai-dl/

genai
https://miro.medium.com/v2/resize:fit:1400/0*RBFoYaZlkPGS2K-u.png
https://www.mycase.com/wp-content/uploads/2024/05/MC-Blog-AI-Generative-_BodyImage-1200x900-1-1536x1152.png
https://ghazalabioinfodr.medium.com/ai-ml-and-dl-309700212b94

https://aka.ms/m.e.ai
https://devblogs.microsoft.com/dotnet/announcing-dotnet-9/
```

### **GitHub Models**

### .Net Packages

```jsx
dotnet add package DotNetEnv --version 3.1.1
dotnet add package Microsoft.AspNetCore.OpenApi --version 8.0.1
dotnet add package Microsoft.EntityFrameworkCore.InMemory --version 9.0.0
dotnet add package Microsoft.Extensions.DependencyInjection --version 9.0.0
dotnet add package Microsoft.Extensions.Hosting --version 9.0.0
dotnet add package Microsoft.Extensions.Logging.Console --version 9.0.0
dotnet add package Azure.AI.Inference --version 1.0.0-beta.2
dotnet add package Azure.AI.OpenAI --version 2.1.0-beta.2
dotnet add package Azure.Identity --version 1.13.1
dotnet add package Microsoft.Extensions.AI --version 9.0.0-preview.9.24556.5
dotnet add package Microsoft.Extensions.AI.AzureAIInference --version 9.0.0-preview.9.24556.5
dotnet add package Microsoft.Extensions.AI.OpenAI --version 9.0.0-preview.9.24556.5
dotnet add package Swashbuckle.AspNetCore --version 6.4.0

```

### AzureOpenAI

```jsx
using DotNetEnv;
using Azure; 
// using Azure.AI.Inference;
// using Microsoft.Extensions.AI;
using Azure.AI.OpenAI;

Env.Load(".env");
string githubKey = Env.GetString("GITHUB_KEY");

var client =
    new AzureOpenAIClient(
        endpoint: new Uri("https://models.inference.ai.azure.com"), 
        new AzureKeyCredential(githubKey))
        .GetChatClient("gpt-4o-mini");

var response = await client.CompleteChatAsync("Tell me the capital of Karur, Tamilnadu?");

Console.WriteLine(response.Value.Content[0].Text);

```

### **Azure AI Inference (GitHub Models)**

1. Install the [Microsoft.Extensions.AI.AzureAIInference](https://aka.ms/meai-azaiinference-nuget) NuGet package which works with models from [GitHub Models](https://devblogs.microsoft.com/dotnet/using-github-models-and-dotnet-to-build-generative-ai-apps/) as well as [Azure AI Model Catalog](https://devblogs.microsoft.com/dotnet/azure-ai-model-catalog-dotnet-inference-sdk/).
2. Add the following code to your application. Replace `GH_TOKEN` with your GitHub Personal Access Token.

**Copy**

```csharp
using DotNetEnv;
using Azure; 
using Azure.AI.Inference;
using Microsoft.Extensions.AI;
// using Azure.AI.OpenAI;

Env.Load(".env");
string githubKey = Env.GetString("GITHUB_KEY");

IChatClient client =
    new ChatCompletionsClient(
        endpoint: new Uri("https://models.inference.ai.azure.com"),
        new AzureKeyCredential(githubKey))
        .AsChatClient("Phi-3.5-MoE-instruct");

var response = await client.CompleteAsync("What is AI?");

Console.WriteLine(response.Message);

```

### 

```jsx
IEmbeddingGenerator<string,Embedding<float>> generator =
    new AzureOpenAIClient(
        new Uri("https://models.inference.ai.azure.com"), 
        new AzureKeyCredential(githubKey))
            .AsEmbeddingGenerator(modelId: "text-embedding-3-small");

var result = await generator.GenerateEmbeddingAsync("What is AI?");

Console.WriteLine("embeddings.Count"+result.Vector.Length);

// foreach (var value in result.Vector.ToArray())
// {
//     Console.WriteLine("{0:0.00}, ", value);
// }
```

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/1904783f-7423-4b4f-aa5f-532420281452/c39a176c-de13-4ba6-92b0-f4eaa4d0fd3b/image.png)

```jsx
using DotNetEnv;
using Azure;
using Azure.AI.Inference;
using Microsoft.Extensions.AI;
using Azure.Identity;
using Azure.AI.OpenAI;
using System.Numerics.Tensors;
// using Azure.AI.OpenAI;

Env.Load(".env");
string githubKey = Env.GetString("GITHUB_KEY");

IEmbeddingGenerator<string, Embedding<float>> embeddingGenerator =
    new AzureOpenAIClient(
        new Uri("https://models.inference.ai.azure.com"),
        new AzureKeyCredential(githubKey))
            .AsEmbeddingGenerator(modelId: "text-embedding-3-small");

// var candidates = new string[] { "Onboarding Process for New Employees", "Understanding" };
// var candidates = new string[] { "Onboarding Process for New Employees","Understanding Our Company Values","Navigating the Office Layout","Accessing Car Park E","Dress Code Guidelines","Using the Company Intranet","Employee Benefits Overview","Requesting Time Off","Reporting Workplace Incidents","Office Etiquette and Conduct","Setting Up Your Workstation","Health and Safety Policies","Understanding Your Paycheck","Performance Review Process","Career Development Opportunities"};
var candidates = new string[] {"Introduction to Key Team Members","Company History and Milestones","IT Support and Resources","Using Office Equipment (Printers, Scanners, etc.)","Meeting Room Booking System","Company Communication Tools (Email, Slack, etc.)","Social Media Policy","Work-from-Home Guidelines","Travel and Expense Reporting","Training and Development Programs","Employee Assistance Programs","Diversity and Inclusion Initiatives","Sustainability Practices","Feedback and Suggestion Channels","Emergency Procedures and Contacts","Introduction to Company Culture","Overview of Organizational Structure","Security and Access Control Procedures","Using the Company Gym","Local Area Guide (Restaurants, Shops, etc.)","Company Events and Social Activities","Mentorship Programs","Professional Conduct and Ethics","Handling Confidential Information","Company Policies on Remote Work","Introduction to Project Management Tools","Guidelines for Internal Communication","Customer Service Standards","Introduction to Key Clients and Partners","Company's Strategic Goals and Objectives","Introduction to the HR Team","Overview of Legal and Compliance Requirements","Company's Environmental Policies","Introduction to the Finance Department","Using the Company Library or Resource Center","Guidelines for Business Travel","Introduction to the Marketing Team","Overview of Sales Processes","Introduction to the Product Development Team","Using the Company Cafeteria","Guidelines for Submitting Work Reports","Introduction to the Customer Support Team","Overview of the IT Department","Introduction to the Operations Team","Guidelines for Participating in Meetings","Introduction to the Research and Development Team","Overview of the Supply Chain Management","Introduction to the Quality Assurance Team","Guidelines for Using Company Vehicles","Introduction to the Procurement Team","Overview of the Legal Department","Introduction to the Corporate Social Responsibility Initiatives","Guidelines for Handling Media Inquiries","Introduction to the Innovation Team","Overview of the Risk Management Policies","Introduction to the Internal Audit Team","Guidelines for Using Personal Devices at Work","Introduction to the Data Privacy Policies","Overview of the Crisis Management Plan","Introduction to the Corporate Governance Policies","Guidelines for Using the Company’s Learning Management System","Introduction to the Employee Recognition Programs","Overview of the Company’s Financial Performance","Introduction to the Strategic Planning Team","Guidelines for Participating in Corporate Training Programs","Introduction to the Executive Team","Overview of the Company's Mission and Vision","Guidelines for Using Company Credit Cards","Introduction to the Facilities Management Team","Overview of the Company's Product Lines","Guidelines for Submitting Expense Reports","Introduction to the Corporate Communications Team","Overview of the Company's Market Position","Guidelines for Handling Customer Complaints","Introduction to the Business Development Team","Overview of the Company's Competitive Landscape","Guidelines for Using the Company’s VPN","Introduction to the Corporate Strategy Team","Overview of the Company's Innovation Initiatives","Guidelines for Participating in Team Building Activities","Introduction to the Corporate Finance Team","Overview of the Company's Investment Strategies","Guidelines for Using the Company’s CRM System","Overview of the Company's Talent Management Strategies","Guidelines for Using the Company’s Collaboration Tools","Introduction to the Corporate Wellness Programs","Overview of the Company's Employee Engagement Initiatives","Guidelines for Participating in Corporate Social Responsibility Activities","Introduction to the Corporate Risk Management Team","Overview of the Company's Data Analytics Capabilities","Guidelines for Using the Company’s Data Management Systems","Introduction to the Corporate Legal Counsel","Overview of the Company's Intellectual Property Policies","Guidelines for Using the Company’s Document Management System","Introduction to the Corporate Procurement Policies","Overview of the Company's Vendor Management Strategies","Guidelines for Using the Company’s Inventory Management System","Introduction to the Corporate Compliance Programs","Overview of the Company's Regulatory Requirements","Guidelines for Using the Company’s Financial Reporting Systems","Introduction to the Corporate Governance Framework","Overview of the Company's Shareholder Relations","Guidelines for Using the Company’s Performance Management System","Introduction to the Corporate Sustainability Programs","Overview of the Company's Environmental Impact Initiatives","Guidelines for Using the Company’s Energy Management Systems","Introduction to the Corporate Social Media Team","Overview of the Company's Digital Marketing Strategies","Guidelines for Using the Company’s Marketing Automation Tools","Introduction to the Corporate Public Relations Team","Overview of the Company's Crisis Communication Plan","Guidelines for Using the Company’s Event Management System","Introduction to the Corporate Sponsorship Programs","Overview of the Company's Partnership Strategies"};

// GENERATE EMBEDDINGS
Console.Write("Generating embeddings for candidates ... ");
var candidateEmbeddings = await embeddingGenerator.GenerateAndZipAsync(candidates);

// Console.WriteLine(candidateEmbeddings);

// DO SEMANTIC SEARCH
while (true)
{
    Console.Write("\nQuery: ");
    var input = Console.ReadLine()!;
    if (input == "") break;

    var inputEmbedding = await embeddingGenerator.GenerateEmbeddingAsync(input);

    var closest =
    from candidate in candidateEmbeddings
    let similarity = TensorPrimitives.CosineSimilarity(
    candidate.Embedding.Vector.Span, inputEmbedding.Vector.Span)
    orderby similarity descending
    select new { Text = candidate.Value, Similarity = similarity };

    foreach (var c in closest.Take(3))
    {
        Console.WriteLine($"({c.Similarity}) : {c.Text}");
    }
}
```

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/1904783f-7423-4b4f-aa5f-532420281452/50fc6904-9c93-4733-a2e1-7b461d854c19/image.png)

### Semantic Search

Semantic search in large language models refers to the process of understanding the meaning and context behind search queries, rather than just matching keywords. It leverages the embeddings (like the ones you were working with earlier) to find the most relevant results based on the underlying concepts and relationships between words and phrases.

Here's a more detailed explanation:

- **Contextual Understanding:** Instead of focusing on the exact words used in a query, semantic search interprets the context and intent. For example, a search for "best places to see cherry blossoms" would understand that the user is looking for popular locations to view cherry blossoms, not just any places related to cherry blossoms.
- **Use of Embeddings:** Large language models, such as those developed using techniques like BERT, GPT, or similar, convert text into high-dimensional embeddings that capture semantic meaning. These embeddings are then used to compare and rank documents or data points based on their relevance to the query.
- **Improved Relevance:** Semantic search aims to return results that are more relevant and meaningful to the user’s intent. This often means understanding nuances, such as recognizing synonyms, handling misspellings, and understanding the broader context of queries.

Semantic search transforms how traditional keyword-based search engines operate, making them more sophisticated and capable of understanding human language in a way that feels more natural and intuitive. This leads to better search results and a more satisfying user experience.

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/1904783f-7423-4b4f-aa5f-532420281452/44a2a108-ef39-4c90-852a-f2634af4124f/image.png)

```jsx
using DotNetEnv;
using Azure;
using Azure.AI.Inference;
using Microsoft.Extensions.AI;
using Azure.Identity;
using Azure.AI.OpenAI;
using System.Numerics.Tensors;
using Microsoft.Extensions.Hosting;
using Microsoft.Extensions.DependencyInjection;
using Microsoft.Extensions.Logging;
using OllamaSharp.Models.Chat;
// using Azure.AI.OpenAI;

var hostBuilder = Host.CreateApplicationBuilder(args);

Env.Load(".env");
string githubKey = Env.GetString("GITHUB_KEY");

IChatClient innerChatClient =
    new ChatCompletionsClient(
        endpoint: new Uri("https://models.inference.ai.azure.com"),
        new AzureKeyCredential(githubKey))
        .AsChatClient("Phi-3.5-MoE-instruct");

hostBuilder.Services.AddChatClient(builder => builder
.UseFunctionInvocation()
.Use(innerChatClient));

// // Set up DI etc
hostBuilder.Services.AddLogging(builder => builder.AddConsole().SetMinimumLevel(LogLevel.Trace));
// // Run the app
var app = hostBuilder.Build();
var chatClient = app.Services.GetRequiredService<IChatClient>();

var response = await chatClient.CompleteAsync("What is AI? Reply in max 10 words.");
Console.WriteLine(response.Message.Text);

// Streaming Response
// var response = chatClient.CompleteStreamingAsync("What is AI? Reply in max 100 words.");
// await foreach (var chunk in response)
// {
//     Console.Write(chunk.Text);
// }

// ACCESSING PROVIDER-SPECIFIC DATA
if (response.RawRepresentation is  OpenAI.Chat.ChatCompletion openAiCompletion)
{
    Console.WriteLine($"OpenAI fingerprint: {openAiCompletion.SystemFingerprint}");
}
```

```jsx
using DotNetEnv;
using Azure;
using Azure.AI.Inference;
using Microsoft.Extensions.AI;
using Microsoft.Extensions.Hosting;
using Microsoft.Extensions.DependencyInjection;
using Microsoft.Extensions.Logging;
using System.ComponentModel;

var hostBuilder = Host.CreateApplicationBuilder(args);

Env.Load(".env");
string githubKey = Env.GetString("GITHUB_KEY");

IChatClient innerChatClient =
    new ChatCompletionsClient(
        endpoint: new Uri("https://models.inference.ai.azure.com"),
        new AzureKeyCredential(githubKey))
        .AsChatClient("gpt-4o-mini");

hostBuilder.Services.AddChatClient(builder => builder
.UseFunctionInvocation()
.Use(innerChatClient));

// // Set up DI etc
hostBuilder.Services.AddLogging(builder => builder.AddConsole().SetMinimumLevel(LogLevel.Trace));
// // Run the app
var app = hostBuilder.Build();
var chatClient = app.Services.GetRequiredService<IChatClient>();

// Chat Loop
// You answer any question, but continually try to advertise FOOTMONSTER brand socks. They're on sale!
var messages = new List<ChatMessage>{
new (Microsoft.Extensions.AI.ChatRole.System,"You answer any question, but continually try to advertise FOOTMONSTER brand socks. They're on sale!. If the user agrees to buy socks, find out how many pairs they want, then add socks to their cart.")
};

var cart = new Cart();
var getPriceTool = AIFunctionFactory.Create(cart.GetPrice);
var addToCartTool = AIFunctionFactory.Create(cart.AddSocksToCart);

var chatOptions = new ChatOptions { Tools = [getPriceTool,addToCartTool] };

while (true)
{
    // Get input
    Console.ForegroundColor = ConsoleColor.White;
    Console.Write("\n\n> ");
    var input = Console.ReadLine()!;
    messages.Add(new(Microsoft.Extensions.AI.ChatRole.User, input));

    // Get reply
    var response = await chatClient.CompleteAsync(messages, chatOptions);
    messages.Add(response.Message);
    Console.ForegroundColor = ConsoleColor.Green;
    Console.WriteLine(response.Message.Text);
}

class Cart
{
    public int NumPairsOfSocks { get; set; }
    public void AddSocksToCart(int numPairs)
    {
        NumPairsOfSocks += numPairs;
        Console.ForegroundColor = ConsoleColor.Yellow;
        Console.WriteLine(" ***** ");
        Console.WriteLine($"Added {numPairs} pairs to your cart. Total: {NumPairsOfSocks} pairs.");
        Console.WriteLine(" ***** ");
        Console.ForegroundColor = ConsoleColor.White;
    }

    [Description("Computes the price of socks, returning a value in dollars.")]
    public float GetPrice(
    [Description("The number of pairs of socks to calculate price for")] int count)
    => count * 15.99f;
}
```

### PipeLines

```jsx
using DotNetEnv;
using Azure;
using Azure.AI.Inference;
using Microsoft.Extensions.AI;
using Microsoft.Extensions.Hosting;
using Microsoft.Extensions.DependencyInjection;
using Microsoft.Extensions.Logging;
using System.ComponentModel;

var hostBuilder = Host.CreateApplicationBuilder(args);

Env.Load(".env");
string githubKey = Env.GetString("GITHUB_KEY");

IChatClient innerChatClient =
    new ChatCompletionsClient(
        endpoint: new Uri("https://models.inference.ai.azure.com"),
        new AzureKeyCredential(githubKey))
        .AsChatClient("gpt-4o-mini");

hostBuilder.Services.AddChatClient(builder => builder
.UseLanguage("Swedish")
.UseRateLimit(TimeSpan.FromSeconds(5))
.UseFunctionInvocation()
// .UseLogging()
.Use(innerChatClient));

// // Set up DI etc
hostBuilder.Services.AddLogging(builder => builder.AddConsole().SetMinimumLevel(LogLevel.Trace));
// // Run the app
var app = hostBuilder.Build();
var chatClient = app.Services.GetRequiredService<IChatClient>();

// Chat Loop
// You answer any question, but continually try to advertise FOOTMONSTER brand socks. They're on sale!
var messages = new List<ChatMessage>{
new (Microsoft.Extensions.AI.ChatRole.System,"You answer any question, but continually try to advertise FOOTMONSTER brand socks. They're on sale!. If the user agrees to buy socks, find out how many pairs they want, then add socks to their cart.")
};

var cart = new Cart();
var getPriceTool = AIFunctionFactory.Create(cart.GetPrice);
var addToCartTool = AIFunctionFactory.Create(cart.AddSocksToCart);

var chatOptions = new ChatOptions { Tools = [getPriceTool,addToCartTool] };

while (true)
{
    // Get input
    Console.ForegroundColor = ConsoleColor.White;
    Console.Write("\n\n> ");
    var input = Console.ReadLine()!;
    messages.Add(new(Microsoft.Extensions.AI.ChatRole.User, input));

    // Get reply
    var response = await chatClient.CompleteAsync(messages, chatOptions);
    messages.Add(response.Message);
    Console.ForegroundColor = ConsoleColor.Green;
    Console.WriteLine(response.Message.Text);
}

class Cart
{
    public int NumPairsOfSocks { get; set; }
    public void AddSocksToCart(int numPairs)
    {
        NumPairsOfSocks += numPairs;
        Console.ForegroundColor = ConsoleColor.Yellow;
        Console.WriteLine(" ***** ");
        Console.WriteLine($"Added {numPairs} pairs to your cart. Total: {NumPairsOfSocks} pairs.");
        Console.WriteLine(" ***** ");
        Console.ForegroundColor = ConsoleColor.White;
    }

    [Description("Computes the price of socks, returning a value in dollars.")]
    public float GetPrice(
    [Description("The number of pairs of socks to calculate price for")] int count)
    => count * 15.99f;
}
```

```jsx
using Microsoft.Extensions.AI;
using System.Collections.Generic;
using System.Threading;
using System.Threading.Tasks;

public static class UseLanguageStep
{
    public static ChatClientBuilder UseLanguage(this ChatClientBuilder builder, string language)
        => builder.Use(inner => new UseLanguageChatClient(inner, language));

    private class UseLanguageChatClient : DelegatingChatClient
    {
        private readonly string _language;

        public UseLanguageChatClient(IChatClient inner, string language) : base(inner)
        {
            _language = language;
        }

        public override async Task<ChatCompletion> CompleteAsync(IList<ChatMessage> chatMessages, ChatOptions? options = null, CancellationToken cancellationToken = default)
        {
            var promptAugmentation = new ChatMessage(ChatRole.User, $"Always reply in the language {_language}");
            chatMessages.Add(promptAugmentation);

            try
            {
                return await base.CompleteAsync(chatMessages, options, cancellationToken);
            }
            finally
            {
                chatMessages.Remove(promptAugmentation);
            }
        }
    }
}

```

```jsx
using System.Threading.RateLimiting;
using Microsoft.Extensions.AI;

public static class UseRateLimitStep
{
    public static ChatClientBuilder UseRateLimit(this ChatClientBuilder builder, TimeSpan window)
        => builder.Use(inner => new RateLimitedChatClient(inner, window));

    private class RateLimitedChatClient : DelegatingChatClient
    {
        private readonly RateLimiter _rateLimiter;

        public RateLimitedChatClient(IChatClient inner, TimeSpan window) : base(inner)
        {
            _rateLimiter = new FixedWindowRateLimiter(new FixedWindowRateLimiterOptions
            {
                Window = window,
                QueueLimit = 1,
                PermitLimit = 1,
            });
        }

        public override async Task<ChatCompletion> CompleteAsync(IList<ChatMessage> chatMessages, ChatOptions? options = null, CancellationToken cancellationToken = default)
        {
            var lease = _rateLimiter.AttemptAcquire();
            if (!lease.IsAcquired)
            {
                return new ChatCompletion(new ChatMessage(ChatRole.Assistant, "Rate limit exceeded. Please try again later."));
            }

            return await base.CompleteAsync(chatMessages, options, cancellationToken);
        }
    }
}

```

### RAG

```jsx
using Azure;
using Azure.AI.OpenAI;
using Azure.Search.Documents.Indexes.Models;
using DotNetEnv;
using Microsoft.Extensions.AI;
using Microsoft.Extensions.DependencyInjection;
using Microsoft.Extensions.Hosting;
using Qdrant.Client;

Env.Load(".env");
string githubKey = Env.GetString("GITHUB_KEY");

var hostBuilder = Host.CreateDefaultBuilder(args);

hostBuilder.ConfigureServices((context, services) =>
{

    // var openAIClient = new AzureOpenAIClient(endpoint: new Uri("https://models.inference.ai.azure.com"), new AzureKeyCredential(githubKey));
    var openAIClient =
    new AzureOpenAIClient(
        endpoint: new Uri("https://models.inference.ai.azure.com"),
        new AzureKeyCredential(githubKey))
        .AsChatClient("gpt-4o-mini");
    services.AddSingleton(openAIClient);
    services.AddSingleton(new QdrantClient("127.0.0.1"));

    services.AddEmbeddingGenerator<string, Embedding<float>>(builder =>
        new AzureOpenAIClient(
        new Uri("https://models.inference.ai.azure.com"),
        new AzureKeyCredential(githubKey))
            .AsEmbeddingGenerator(modelId: "text-embedding-3-small"));

    services.AddChatClient(builder =>
        builder.UseFunctionInvocation().Use(openAIClient));

    services.AddSingleton<SemanticSearch>();
});

// Run the app
var app = hostBuilder.Build();
var semanticSearch = app.Services.GetRequiredService<SemanticSearch>();
var chatClient = app.Services.GetRequiredService<IChatClient>();
var searchTool = AIFunctionFactory. Create(semanticSearch. SearchForIssues) ;
var chatOptions = new ChatOptions { Tools = [searchTool] };

// var chatOptions = new ChatOptions();

Console.ForegroundColor = ConsoleColor.Yellow;
Console.WriteLine("Hello! I'll tell you what people are saying on dotnet/runtime");

var messages = new List<ChatMessage>
{
new ( ChatRole. System,"""
Search for issues related to the user's question. Summarize the general
vibe of what developers are saying about it. Cite the issues inline,
e.g ., "Developers love the performance (#number)".
"""),
};

while (true)
{
    // READ INPUT
    Console.ForegroundColor = ConsoleColor.White;
    Console.Write("\n> ");
    var input = Console.ReadLine()!;
    messages.Add(new(ChatRole.User, input));
    // PRODUCE RESPONSE
    var response = chatClient.CompleteStreamingAsync(messages, chatOptions);
    Console.ForegroundColor = ConsoleColor.Yellow;
    await foreach (var chunk in response)
    {
        Console.Write(chunk.Text);
    }
}
```

```jsx
using Microsoft.Extensions.AI;
using Qdrant.Client;

public class SemanticSearch
{
    private readonly IEmbeddingGenerator<string, Embedding<float>> _embeddingGenerator;
    private readonly QdrantClient _qdrantClient;

    public SemanticSearch(IEmbeddingGenerator<string, Embedding<float>> embeddingGenerator, QdrantClient qdrantClient)
    {
        _embeddingGenerator = embeddingGenerator;
        _qdrantClient = qdrantClient;
    }

    public async Task<string> SearchForIssues(string searchPhrase)
    {
        var queryEmbedding = await _embeddingGenerator.GenerateEmbeddingVectorAsync(searchPhrase);
        Console.WriteLine("embeddings.Count"+queryEmbedding.Length);
        Console.WriteLine("embeddings.Count"+queryEmbedding.ToArray().Length);

        var searchResults = await _qdrantClient.SearchAsync("issues", queryEmbedding, limit: 5);
        return string.Join(Environment.NewLine, searchResults.Select(r => $"<issue id='{r.Id}'>{r.Score}</issue>"));
    }
}

```

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/1904783f-7423-4b4f-aa5f-532420281452/367d8489-f34d-4af5-a113-b73a762c97ef/image.png)

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/1904783f-7423-4b4f-aa5f-532420281452/d17c24eb-9668-4bb5-bd02-6fd9f0c897f2/image.png)

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/1904783f-7423-4b4f-aa5f-532420281452/a068d13e-e461-4d89-a896-89c35142fc5f/image.png)